---
// src/pages/index.astro
import Layout from '@/components/astro/layout.astro';
import Hero from '@/components/astro/hp-hero.astro';
import FeaturedCarousel from '@/components/react/content/FeaturedCarousel.jsx';
import FilteredContent from '@/components/react/content/FilteredContent.jsx';
import ReelsCarousel from '@/components/react/content/ReelsCarousel.jsx';
import CommunityCarousel from '@/components/react/content/CommunityCarousel.jsx';
import CategoryGrid from '@/components/react/discovery/CategoryGrid.jsx';
import NewsletterSignUp from '@/components/react/ui/NewsletterSignUp.jsx';
import {
  FEATURED_SLIDES,
  REELS_DATA,
  CARD_GRADIENTS,
  CREATORS,
  HOME_CATEGORIES
} from '@/data/constants';
import '@/styles/global.css';

// --- Page SEO ---
const shareImage = "/images/social/home-page-share-image.jpg";
const shareDescription = "A warm, visual community for Machine Creativity and AI-generated content. Discover amazing creations made with your favorite AI tools.";

// --- Mock video data (page-specific) ---
const VIDEO_TITLES = [
  'Cannabis Strain Review: Blue Dream', 'How to Roll the Perfect Joint', 'Top 5 Detroit Coffee Shops',
  'Food Truck Festival Highlights', 'Downtown Detroit Dispensary Tour', 'Cooking with Cannabis: Basics',
  'Local Artist Spotlight', 'Morning Routine at Coffee House Detroit', 'Product Unboxing: New Vape Pen',
  'Late Night Food Options in Detroit', 'DIY Cannabis Tinctures', 'Weekend Events Roundup'
];
const VIDEO_BUSINESSES = [
  'Detroit Dabs', 'Detroit Dabs', 'Motor City Muncher', 'Motor City Muncher', 'Detroit Dabs',
  'The Canna-seur', 'Explore Detroit', 'Motor City Muncher', 'The Canna-seur', 'Motor City Muncher',
  'The Canna-seur', 'Explore Detroit'
];
const VIDEO_DURATIONS = ['3:45', '1:20', '4:10', '2:35', '5:15', '8:20', '2:45', '0:58', '6:32', '1:45', '7:15', '3:20'];
const VIDEO_CATEGORIES_DATA = ['videos', 'videos', 'photos', 'photos', 'videos', 'videos', 'events', 'photos', 'videos', 'photos', 'videos', 'events'];

const recentVideos = VIDEO_TITLES.map((title, i) => ({
  id: i + 4,
  title,
  business: VIDEO_BUSINESSES[i],
  duration: VIDEO_DURATIONS[i],
  date: new Date(2025, 5, 24 - i * 2).toISOString().split('T')[0],
  category: VIDEO_CATEGORIES_DATA[i]
}));

// Add latestVideos to creators for CommunityCarousel
const creatorsWithVideos = CREATORS.map(creator => ({
  ...creator,
  latestVideos: recentVideos.filter(v => v.business === creator.name).slice(0, 2)
}));
---

  <Layout 
    title="Meat - The home for Machine Creativity" 
    description={shareDescription}
    shareImage={shareImage}
    >

  <Hero 
    title="Welcome to "
    titleSlot="Meat"
    tagline="The cozy corner of the internet for Machine Creativity"
  />
  
<FeaturedCarousel client:load slides={FEATURED_SLIDES} />

  <div class="max-w-7xl mx-auto px-4 space-y-16">

<FilteredContent
  client:load
  categories={HOME_CATEGORIES}
  videos={recentVideos}
  gradients={CARD_GRADIENTS}
/>

<ReelsCarousel
  client:visible
  reels={REELS_DATA}
  title="AI Reels & Shorts"
/>

<CommunityCarousel
  client:visible
  creators={creatorsWithVideos}
  title="Featured Communities"
  description="Meet the voices and visionaries behind the content."
/>
    
<CategoryGrid client:visible />
    
<NewsletterSignUp client:visible />
  </div>
  
</Layout>

<style is:global>
  /* Styles for the new Hero Slider */
  .hero-slider {
    position: relative; /* Needed for pagination positioning */
  }
  .hero-slider .swiper-slide {
    display: flex;
    align-items: center; /* Vertically center the slide content */
    box-sizing: border-box; /* Ensures padding is included in height calculation */
    min-height: 60vh; /* Minimum height for slides on mobile */
  }

  @media (min-width: 768px) { /* md breakpoint */
    .hero-slider .swiper-slide {
      min-height: 80vh; /* Taller height on larger screens */
    }
  }
  /* The pagination container for the dots */
  .hero-pagination {
    position: absolute;
    bottom: 1.5rem; /* Position dots at the bottom */
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    display: flex;
    gap: 0.75rem; /* Space between dots */
    padding: 0.5rem 1rem;
    background-color: rgba(17, 24, 39, 0.5); /* bg-gray-900 with 50% opacity */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 9999px;
    border: 1px solid rgba(55, 65, 81, 0.5); /* border-gray-700 with 50% opacity */
  }
  /* Individual dot style */
  .hero-pagination .swiper-pagination-bullet {
    width: 0.75rem; /* 12px */
    height: 0.75rem; /* 12px */
    background-color: #6b7280; /* gray-500 */
    opacity: 0.7;
    border-radius: 9999px;
    transition: all 300ms ease-in-out;
    cursor: pointer;
  }
  /* Active dot style */
  .hero-pagination .swiper-pagination-bullet-active {
    background-color: #ffffff; /* white */
    opacity: 1;
    width: 2.5rem; /* Make active dot wider */
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof Swiper !== 'undefined') {
      const heroSwiper = new Swiper('.hero-slider', {
        loop: true,
        effect: 'fade',
        fadeEffect: {
          crossFade: true
        },
        autoplay: {
          delay: 7000,
          disableOnInteraction: false,
        },
        pagination: {
          el: '.hero-pagination',
          clickable: true,
        },
        observer: true,
        observeParents: true,
      });
    }

    // Your existing filter logic
    const filterBar = document.getElementById('filter-bar');
    const videoCards = document.querySelectorAll('.video-card');

    if (filterBar && videoCards.length > 0) {
      filterBar.addEventListener('click', (e) => {
        const target = e.target.closest('.filter-btn');
        if (!target) return;

        const category = target.dataset.category;

        filterBar.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('border-pink-500', 'text-pink-500');
          btn.classList.add('border-transparent', 'text-gray-400');
        });
        target.classList.add('border-pink-500', 'text-pink-500');
        target.classList.remove('border-transparent', 'text-gray-400');

        videoCards.forEach(card => {
          if (card instanceof HTMLElement) { 
            const cardCategory = card.dataset.category;
            if (category === 'all' || category === cardCategory) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });
    }
  });
</script>
